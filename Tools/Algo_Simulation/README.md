# Algorithm Simulation Tools

这个文件夹包含了智能饮水机项目中超声波阈值算法的 Python 原型实现及相关辅助工具。在项目早期，我们使用这些脚本在 PC 端对采集到的超声波原始数据进行分析、算法验证和参数调优，确实可行后再移植为 C 语言版本（位于 `../../water_dispenser3/Core/Src/ultrasonic_threshold.c`）。

## 📂 文件清单

### 核心算法
- **`find_threshold5.py`**
    - **用途**：算法的核心逻辑文件。
    - **功能**：实现了信号平滑 (`smooth`)、峰值检测 (`detect_peaks`)、峰值合并与分类、以及最终的阈值计算逻辑。
    - **说明**：这是 C 语言实现的参考蓝本，其中定义的 `Peak` 类和处理流程与嵌入式代码高度一直。

### 可视化与调试
- **`data.py`**
    - **用途**：数据提取与简单预览。
    - **功能**：用于解析从串口打印的日志数据（格式如 `s:123,456,...`），提取出其中的波形数值并绘制简单的折线图，方便快速查看波形形状。

- **`process_plot.py`**
    - **用途**：算法处理流程可视化。
    - **功能**：分步骤展示算法是如何处理数据的。它可以绘制出：
        1. 原始数据与有效区间。
        2. 平滑处理后的波形。
        3. 初步检测到的峰值。
      这对于理解算法内部发生了什么非常有帮助。

- **`result_plot.py`**
    - **用途**：最终结果可视化。
    - **功能**：利用 `find_threshold5.py` 计算结果，在图表中清晰地标记出：
        - 有效信号区域。
        - 计算出的动态阈值（Threshold Area）。
        - 识别出的不同类型的峰值（边缘峰、液面峰、干扰峰）。

### 硬件通信
- **`UARTAss.py`**
    - **用途**：简易串口调试助手。
    - **功能**：基于 Tkinter 编写的图形化串口工具。除基本的接收/发送功能外，可能包含了一些特定的便捷功能（如自动添加换行符等），方便与 STM32 设备进行交互和数据采集。

## ⚙️ 使用说明

1. **环境准备**：
   确保安装了 Python 3 以及以下依赖库：
   ```bash
   pip install matplotlib numpy pyserial
   ```

2. **验证算法**：
   你可以修改 `data.py` 或 `result_plot.py` 中的 `data` 变量（填入你从设备串口抓取到的 `s:...` 数据串），然后运行脚本即可看到算法的分析结果。

   ```bash
   python result_plot.py
   ```

3. **串口调试**：
   运行串口助手连接开发板：
   ```bash
   python UARTAss.py
   ```
